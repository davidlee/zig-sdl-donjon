# Agents System Overview
- `src/domain/combat/agent.zig` defines the central `Agent` struct that joins together identity (`id`, `name`, `species`, `director`, `draw_style`), stats (`stats`, `stamina`, `focus`, `time_available`), a `Body`, equipped armour stack, weapons, decks (`always_available`, `spells_known`, `deck_cards`), inventory, and combat state (engagements, attention, balance, cooldown metadata, etc.).
- Physiological resources are modeled with `stats.Resource`: blood (existing), pain, trauma, morale, plus stamina/focus/time pools. Helpers expose ratios, ticking, commitment/spend semantics, and condition checks (`isIncapacitated`, `totalBleedingRate`). Because resources share an API, new mechanics can interact with them uniformly.
- Conditions blend stored instances (`conditions` array with expiration) and computed states surfaced through `ConditionIterator`. The iterator walks phases (stored entries, blood loss, engagement pressure, sensory impairment, etc.) and yields `damage.Condition` values with expiration metadata, enabling downstream consumers to treat computed and explicit conditions identically.
- Agents interface with cards (pool membership helpers), armour (`Armament` data), and the event system. Their API emphasizes capability queries (has condition, pool availability, dominant side) so higher-level systems remain declarative and data-driven rather than bespoke per agent.
- `Agent.name` uses a tagged union (`Name`) with `.static` (borrowed/comptime) and `.dynamic` (owned/runtime) variants, enabling NPCs to use static strings while players can have runtime-assigned names.
- `Agent.species` points to a `Species` definition in `src/domain/species.zig`. Species bundles body plan (`[]PartDef`), natural weapons (`NaturalWeapon` with template + required body part), base resource values, and creature tags (`TagSet` over `Tag` enum: humanoid, mammal, predator, undead, etc.). Default is `&DWARF`.
- `Armament` (in `armament.zig`) is a struct combining `equipped: Equipped` (union: unarmed/single/dual/compound) with `natural: []const NaturalWeapon` (from species). Key methods: `fromSpecies()` creates unarmed with natural weapons, `withEquipped()` returns new Armament preserving natural weapons. Availability filtering for body-gated natural weapons happens on Agent, not Armament (keeps Armament as pure data).
- `Body.hasFunctionalPart(tag, side?)` checks if any part with given tag (optionally filtered by side) is functional (not severed, severity != .missing). Used for natural weapon gating.
- T026 (in progress): Agent.init refactor to take species + stat_block only, derive body/resources/natural weapons internally.