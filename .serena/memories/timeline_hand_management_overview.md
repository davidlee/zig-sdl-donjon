# Timeline & Hand Management Overview
- Hand/deck systems live primarily in `src/domain/combat.zig` (agent combat state) and `src/domain/apply/` executors. Agents own `combat_state` with a `hand`, `draw`/`discard` piles, and `timeline` per encounter. Deck composition (always_available, draw pile) is derived from `Agent` pools and handled during encounter initialization.
- Timeline plays are stored in a slot-based structure (`slot_map`, `encounter_state.current`). Each play references a card/entity id, optional target, channel usage (weapon/off-hand/footwork/concentration), and time window. Channel conflicts determine sequencing; manoeuvre overlays and commit/resolve processing iterate these slots (`apply/effects/commit.zig`, `apply/effects/resolve.zig`) to run `on_commit`/`on_resolve` rules via the same cards data pipeline.
- Hand interactions are managed via commands that move cards between zones (hand, discard, exhaust) using `Effect.move_card`, `Effect.exhaust_card`, etc. Validation embraces the card system: `Rule.valid` predicates and targeting queries gate selection; range/engagement is checked at resolution time so the timeline can express “Advance then Attack” sequences without being blocked up front.
- UI reads hands/timelines through query modules (`src/domain/query/combat_snapshot.zig`) to avoid mutating domain state. Play commitment and resolution are driven by the `apply` layer, keeping the core mechanics data-driven and reusable for both player and AI.