# T012: Pain & Trauma Conditions

**Status**: backlog
**Phase**: 4.3 of Increment 4
**Design Doc**: `doc/trauma_wounds_conditions_ph2.md` (Addendum: Revised Increment 4)
**Depends on**: T011

## Goal

ConditionIterator yields pain/trauma conditions at resource thresholds. Incapacitation at 95%.

## Conditions to Add

### Pain Conditions

| Threshold | Condition | Penalties |
|-----------|-----------|-----------|
| 30% | `.distracted` | defense_mult=0.95, hit_chance=-0.05 |
| 60% | `.suffering` | defense_mult=0.85, hit_chance=-0.15, damage_mult=0.9 |
| 85% | `.agonized` | defense_mult=0.70, hit_chance=-0.30, damage_mult=0.7, dodge_mod=-0.2 |

### Trauma Conditions

| Threshold | Condition | Penalties |
|-----------|-----------|-----------|
| 30% | `.dazed` | hit_chance=-0.10, defense_mult=0.95 |
| 50% | `.unsteady` | footwork_mult=0.7, dodge_mod=-0.15 |
| 70% | `.trembling` | hit_chance=-0.10, damage_mult=0.8 |
| 90% | `.reeling` | footwork_mult=0.4, hit_chance=-0.25, defense_mult=0.7, dodge_mod=-0.25 |

### Incapacitation

| Threshold | Condition | Effect |
|-----------|-----------|--------|
| 95% pain OR trauma | `.incapacitated` | Out of fight (like death but recoverable) |

## Changes Required

### `src/domain/damage.zig`

Add to `Condition` enum:
- `.distracted`, `.suffering`, `.agonized`
- `.dazed`, `.unsteady`, `.trembling`, `.reeling`
- `.incapacitated`

Add to `condition_penalties` table (see penalties above).

### `src/domain/combat/agent.zig`

Extend `ConditionIterator.next()`:

```zig
// Incapacitation check (highest priority, before other computed)
if (self.agent.painRatio() >= 0.95 or self.agent.traumaRatio() >= 0.95) {
    return .{ .condition = .incapacitated, .expiration = .dynamic };
}

// Pain phases (check worst first)
8 => if (painRatio() >= 0.85) return .agonized,
9 => if (painRatio() >= 0.60) return .suffering,
10 => if (painRatio() >= 0.30) return .distracted,

// Trauma phases (check worst first)
11 => if (traumaRatio() >= 0.90) return .reeling,
12 => if (traumaRatio() >= 0.70) return .trembling,
13 => if (traumaRatio() >= 0.50) return .unsteady,
14 => if (traumaRatio() >= 0.30) return .dazed,
```

Note: Will need to widen `computed_phase` type and shift engagement phases.

## Tests

- [ ] Pain at 35% yields `.distracted` only
- [ ] Pain at 65% yields `.suffering` only (not both suffering and distracted)
- [ ] Trauma at 55% yields `.unsteady` only
- [ ] Trauma at 75% yields `.trembling` only
- [ ] Pain at 96% yields `.incapacitated`
- [ ] Trauma at 96% yields `.incapacitated`
- [ ] Penalties from conditions applied correctly in resolution

## Acceptance Criteria

- [ ] Build passes
- [ ] All tests pass
- [ ] Lint clean

## Notes

Check worst threshold first so we don't yield multiple conditions from same resource (e.g., both `.agonized` and `.distracted`).

---

**Created**: 2026-01-08
