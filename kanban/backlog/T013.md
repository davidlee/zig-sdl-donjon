# T013: Adrenaline Surge/Crash

**Status**: backlog
**Phase**: 4.4 of Increment 4
**Design Doc**: `doc/trauma_wounds_conditions_ph2.md` (Addendum: Revised Increment 4)
**Depends on**: T012

## Goal

First significant wound triggers adrenaline surge (temporary boost + pain suppression), followed by crash.

## Behavior

1. First wound with severity >= `.inhibited` triggers `.adrenaline_surge` (8 ticks)
2. While surge active: slight hit_chance boost, pain conditions suppressed
3. When surge expires: `.adrenaline_crash` applied (12 ticks)
4. Crash: penalties to hit_chance, defense, footwork

## Changes Required

### `src/domain/damage.zig`

Add conditions:
```zig
.adrenaline_surge,
.adrenaline_crash,
```

Add penalties:
```zig
.adrenaline_surge => .{ .hit_chance = 0.05 },
.adrenaline_crash => .{ .hit_chance = -0.10, .defense_mult = 0.85, .footwork_mult = 0.85 },
```

### Damage Application Path

```zig
// When applying wound with severity >= .inhibited:
if (!agent.hasCondition(.adrenaline_surge) and !agent.hasCondition(.adrenaline_crash)) {
    agent.addCondition(.adrenaline_surge, .{ .ticks = 8 });
}
```

### Condition Expiry Handling

```zig
// When .adrenaline_surge expires:
agent.addCondition(.adrenaline_crash, .{ .ticks = 12 });
```

Need to find where condition expiry is processed and add this transition.

### `src/domain/combat/agent.zig`

ConditionIterator: Skip pain condition phases while `.adrenaline_surge` active:

```zig
// In pain phase checks:
if (self.agent.hasCondition(.adrenaline_surge)) {
    // skip pain conditions
    self.computed_phase += 3; // skip all pain phases
    continue;
}
```

## Tests

- [ ] First `.inhibited` wound triggers `.adrenaline_surge`
- [ ] Second wound does not re-trigger surge
- [ ] Surge provides +0.05 hit_chance
- [ ] Pain conditions not yielded while surge active
- [ ] After 8 ticks, surge expires and crash begins
- [ ] Crash applies penalties for 12 ticks
- [ ] Pain conditions resume after surge ends (even during crash)

## Acceptance Criteria

- [ ] Build passes
- [ ] All tests pass
- [ ] Lint clean

## Notes

Pain still accumulates during surgeâ€”it's just not manifested as conditions. The "delayed collapse" comes from pain conditions suddenly appearing when surge ends.

---

**Created**: 2026-01-08
