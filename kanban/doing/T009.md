# T009: Targeting & Range Validation Redesign

## Problem

Current validation rejects attacks at selection time if no enemy is in range. But with a timeline system, this is wrong:

- Player is out of range
- Player plays Advance (closes distance)
- Player wants to play Attack - but can't, because validation checks *current* range

Also doesn't handle opponent moving away after you've queued an attack.

## Current State (Wrong)

- [x] Attacks have `.target = .all_enemies` - legacy from before targeting was wired up
- [x] `validateMeleeReach` checks if *any* enemy is in range at selection time
- [x] Range is treated as a card validity predicate, not a targeting constraint

## Correct Model

### Validation Categories

**Hard invalid** (reject at selection):
- Channel conflict
- Can't afford costs (stamina/focus/time)
- Wrong phase
- Card requirements (e.g., no weapon equipped)

**Soft invalid** (allow, resolve dynamically):
- No valid targets *currently* - targeting is evaluated at resolution

### Targeting vs Validity

- `Rule.valid` → card-level predicates (weapon equipped, stance requirement)
- Targeting → finds valid targets at resolution time, range included

A melee attack with no targets in range isn't invalid - it just has an empty target set *right now*.

### Attack Flow

1. Advance (target: goblin) → `.single` target, sets primary target, closes range
2. Attack (target: .single) → inherits primary target, range checked at resolution

### Primary Target & Focus Cost

- Advance/Pivot set `attention.primary` to the targeted enemy
- Subsequent attacks default to primary target (no additional selection)
- Switching to a *different* target costs focus
- Primary target resets each turn

## Changes Required

1. [x] **Update attack cards**: `.all_enemies` → `.single` (except true multi-target attacks)
3. [x] **Remove selection-time range validation**: `validateMeleeReach` should not block card selection
4. [x] **Add resolution-time range check**: When attack resolves, check range to actual target
5. **Handle whiff case**: Attack against out-of-range target misses/fizzles with feedback (needs feedback)

## TODO / REMAINING: UI Implications

- Cards with no *current* valid targets should show differently (not fully greyed, but indicate "no target")
- Timeline plays should show warning if target not yet valid (clears when e.g. Advance resolves)
- Expose validation failure reasons to UI (not just pass/fail)