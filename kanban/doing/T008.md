# T008: Timeline Card Rendering

**Status**: in_progress
**Phase**: 0 of 7 (Timeline UI - Phase 0 Visual Prototype)
**Design Doc**: `doc/timeline-ui-plan.md`
**Depends on**: T007 (carousel)

## Goal

Render plays on a timeline grid with channel lanes (weapon, off_hand, footwork) and time slots (0.0-1.0 in 0.1 increments). Replace solitaire-style play stacks with timeline positioning.

## Progress

### Completed
- [x] Extended `play.Data` with `time_start`, `time_end`, `channels` fields
- [x] Added `channelY()` and `channelSpan()` helpers for multi-channel positioning
- [x] Created `TimelineView` in `play.zig`:
  - 3 channel lanes (weapon, off_hand, footwork) x 10 time slots (100px each)
  - Lane backgrounds (alternating black/dark grey)
  - Grid lines
  - Channel labels on right side
- [x] Updated `buildPlayViewData` to accept `TimeSlot` and populate timing/channels
- [x] Added `buildPlayViewDataFromCard` for selection phase (synthesizes timing from in_play cards)
- [x] Integrated TimelineView into combat renderables (replaces old PlayZoneView)
- [x] Updated hit testing for timeline (hitTestPlayerCards, handleDragging, onClick)
- [x] Duration bars: dark blue rect behind card showing occupied time slots
- [x] Cards render at normal size (not stretched)
- [x] Non-technique cards now show (default to weapon channel, 0.2s duration)

### Current Parameters
```zig
// In TimelineView (play.zig)
const slot_width: f32 = 100;    // 100px per 0.1s slot
const lane_height: f32 = 110;   // card height per channel
const num_slots: usize = 10;    // 0.0-1.0
const num_lanes: usize = 3;     // weapon, off_hand, footwork
const start_x: f32 = 60;        // left margin
const start_y: f32 = 120;       // below header
const duration_bar_color = Color{ .r = 30, .g = 50, .b = 80, .a = 255 }; // dark blue
```

### In Progress
- [ ] Fine-tuning layout/positioning

## Remaining Tasks (Phase 0)

- [ ] Time labels along top (needs arena string allocation)
- [ ] Modifier rune chips on play cards
- [ ] Better visual for multi-channel plays spanning lanes
- [ ] Target indicator on plays

## Key Files Modified

- `src/presentation/views/combat/play.zig` - TimelineView, Data extended
- `src/presentation/views/combat/view.zig` - buildPlayViewDataFromCard, timeline integration
- `src/presentation/views/combat/mod.zig` - TimelineView export

## Handover Notes

### Selection vs Commit Phase
- **Selection phase**: Cards are in `combat_state.in_play`, no TimeSlots yet
  - `buildPlayViewDataFromCard` synthesizes timing by walking cards sequentially
  - Channels from technique, duration from `cost.time`
- **Commit phase**: Cards are in `TurnState.timeline` as `TimeSlot`s
  - `buildPlayViewData` extracts real timing from slots

### Layout Math
```zig
// Time position: time_start * (slot_width / 0.1) = time_start * 1000
// Channel position: channelY() returns 0/1/2 (or midpoint for multi-channel)
// Duration bar: inset 4px, spans full time width
// Card: normal size (80x110), positioned at time_start
```

---

**Created**: 2026-01-07
