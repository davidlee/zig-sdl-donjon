# T007: Card Carousel Layout

**Status**: done
**Phase**: 0 of 7 (Timeline UI)
**Design Doc**: `doc/timeline-ui-plan.md`
**Depends on**: None (independent UI task, can parallel T006)

## Goal

Replace current card rows (hand + known) with a single overlapping carousel at the bottom edge. Cards peek from bottom, fan out on hover.

## Progress

### Completed
- [x] 7.1 CarouselView struct created in `src/presentation/views/combat/view.zig`
- [x] 7.2 Cards positioned at bottom edge (base_y = viewport_h - card_h)
- [x] 7.3 Group gap (30px) between hand and known sections
- [x] 7.4-7.6 Dock-style continuous animation (Apple dock style, no state machine)
  - X-based spreading: sine wave formula anchors edges, parts at mouse
  - Y-based raising: cards lift when mouse approaches vertically
  - Virtual margin (0.10) so edge cards move slightly too
- [x] Disabled card transparency fixed (solid dark grey, alpha=255)
- [x] 7.x Card rotation/angling
  - `CardPlacement` internal struct bundles rect + rotation
  - `cardPlacements()` calculates rotation from weight: `rotation = weight * max_rotation`
  - `renderCard` uses SDL3's `renderTextureRotated` API
  - Left cards tilt left (negative), right cards tilt right (positive), center is vertical
  - Fixed: `onClick` now uses carousel.hitTest (was using old zone positions)

### Current Parameters (tune as needed)
```zig
// In CarouselView (view.zig ~line 212-217)
const max_raise: f32 = 20;           // pixels to lift on hover
const influence_radius_x: f32 = 100; // horizontal spread influence
const influence_radius_y: f32 = 150; // vertical raise influence
const max_displacement: f32 = 120;   // pixels for sine spread (in cardPlacements)
const margin: f32 = 0.10;            // virtual edge margin (in cardPlacements)
const max_rotation: f32 = 15;        // max degrees to tilt at edges
```

### In Progress
(none)

## Handover Notes

### Spread & Rotation Algorithm
The key formula in `cardPlacements()`:
```zig
// t = normalized card position with margin [0.1, 0.9]
// m = normalized mouse position [0, 1]
const weight: f32 = if (t < m and m > 0.001)
    -@sin(std.math.pi * t / m)        // left of mouse: negative weight
else if (t > m and m < 0.999)
    @sin(std.math.pi * (t - m) / (1.0 - m))  // right: positive weight
else
    0;
// Weight drives both X displacement and rotation
card_x = base_x + weight * max_displacement;
rotation = weight * max_rotation;
```

### Key Files Modified
- `src/presentation/views/combat/view.zig` - CarouselView with CardPlacement struct
- `src/presentation/views/types.zig` - rotation field on Card
- `src/presentation/card_renderer.zig` - Fixed disabled card alpha
- `src/presentation/graphics.zig` - renderCard uses renderTextureRotated

---

## Original Design

```
┌─────────────────────────────────────────────────────────────────┐
│  ... main combat area ...                                       │
├┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┤
│  ┌──┬──┬──┬──┐   ┌──┬──┬──┬──┬──┬──┬──┬──┬──┬──┬──┬──┐          │
│  │  │  │  │Ha│ ~ │  │  │  │  │  │  │  │  │  │  │  │Kn│          │
└──┴──┴──┴──┴nd┴───┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴wn┴──────────┘
```

## Remaining Tasks

- [x] 7.x Card rotation/angling
- [ ] 7.9 Handle varying card counts gracefully
- [ ] 7.10 Visual distinction hand vs known (border/label)

## Acceptance Criteria

- [x] Hand + known cards in single bottom-edge row
- [x] Cards overlap
- [x] Hover near bottom fans cards up (dock-style continuous)
- [x] Click/drag still works for card selection
- [x] Visual separation between hand and known groups

---

**Created**: 2026-01-07
**Completed**: 2026-01-07
